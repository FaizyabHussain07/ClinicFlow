{
    "rules": {
        "users": {
            ".read": "auth != null",
            ".indexOn": [
                "role"
            ],
            "$uid": {
                ".read": "auth != null",
                ".write": "auth != null && (auth.uid === $uid || root.child('users').child(auth.uid).child('role').val() === 'admin')",
                ".validate": "newData.hasChildren(['name', 'email', 'role'])",
                "role": {
                    ".validate": "newData.val() === 'doctor' || newData.val() === 'receptionist' || newData.val() === 'patient' || (newData.val() === 'admin' && root.child('users').child(auth.uid).child('role').val() === 'admin')"
                }
            }
        },
        "patients": {
            ".read": "auth != null && (root.child('users').child(auth.uid).child('role').val() === 'admin' || root.child('users').child(auth.uid).child('role').val() === 'doctor' || root.child('users').child(auth.uid).child('role').val() === 'receptionist')",
            ".write": "auth != null && (root.child('users').child(auth.uid).child('role').val() === 'admin' || root.child('users').child(auth.uid).child('role').val() === 'receptionist')",
            "$patientId": {
                ".read": "auth != null && (auth.uid === $patientId || root.child('users').child(auth.uid).child('role').val() === 'admin' || root.child('users').child(auth.uid).child('role').val() === 'doctor' || root.child('users').child(auth.uid).child('role').val() === 'receptionist')"
            }
        },
        "diseaseForms": {
            ".read": "auth != null",
            ".indexOn": [
                "patientId"
            ],
            "$formId": {
                ".read": "auth != null && (data.child('patientId').val() === auth.uid || root.child('users').child(auth.uid).child('role').val() === 'admin' || root.child('users').child(auth.uid).child('role').val() === 'doctor' || root.child('users').child(auth.uid).child('role').val() === 'receptionist')",
                ".write": "auth != null && (root.child('users').child(auth.uid).child('role').val() === 'admin' || root.child('users').child(auth.uid).child('role').val() === 'receptionist' || (newData.exists() && newData.child('patientId').val() === auth.uid) || (data.exists() && data.child('patientId').val() === auth.uid))",
                ".validate": "newData.hasChildren(['patientId', 'symptoms'])"
            }
        },
        "appointments": {
            ".read": "auth != null",
            ".indexOn": [
                "patientId",
                "doctorId",
                "date"
            ],
            "$appointmentId": {
                ".read": "auth != null && (data.child('patientId').val() === auth.uid || data.child('doctorId').val() === auth.uid || root.child('users').child(auth.uid).child('role').val() === 'admin' || root.child('users').child(auth.uid).child('role').val() === 'receptionist')",
                ".write": "auth != null && (root.child('users').child(auth.uid).child('role').val() === 'admin' || root.child('users').child(auth.uid).child('role').val() === 'receptionist' || root.child('users').child(auth.uid).child('role').val() === 'doctor')",
                ".validate": "newData.hasChildren(['patientId', 'doctorId', 'date'])"
            }
        },
        "prescriptions": {
            ".read": "auth != null",
            ".indexOn": [
                "patientId",
                "doctorId"
            ],
            "$prescriptionId": {
                ".read": "auth != null && (data.child('patientId').val() === auth.uid || data.child('doctorId').val() === auth.uid || root.child('users').child(auth.uid).child('role').val() === 'admin')",
                ".write": "auth != null && (root.child('users').child(auth.uid).child('role').val() === 'admin' || root.child('users').child(auth.uid).child('role').val() === 'doctor')",
                ".validate": "newData.hasChildren(['patientId', 'doctorId', 'medicines'])"
            }
        }
    }
}